<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Movie Details</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body {background-image: linear-gradient(to top, #c9ffbf 10%, #d5dee7 30%, #ace0f9 100%);}
    .container { margin-top: 30px; background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    .poster-img { width: 100%; max-width: 400px; border-radius: 10px; }
    .video-container { width: 100%; max-width: 800px; margin-bottom: 20px; }
    video { width: 100%; border-radius: 10px; }
    .info-section { margin-top: 20px; }
    .info-section p { margin-bottom: 10px; }
    @media(min-width: 768px) { 
      .content-flex { display: flex; gap: 20px; }
      .video-container { flex: 1; }
      .info-section { flex: 1; }
    }
    .bg-pic{
      background-image: linear-gradient(to top, #ace0f9 0%, #c9ffbf 100%);
    }
    p{
      color: #D7DDE8;
      font-family: cursive;
    }
    a {
        text-decoration: none;
        color: black;
      }
    .post-bg {
              background: #606c88;  /* fallback for old browsers */
              background: -webkit-linear-gradient(to right, #3f4c6b, #606c88);  /* Chrome 10-25, Safari 5.1-6 */
              background: linear-gradient(to right, #3f4c6b, #606c88); /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */

              }
    
      .btn-grad {background-image: linear-gradient(to right, #abbaab 0%, #ffffff  51%, #abbaab  100%)}
         .btn-grad {
            margin: 10px;
            padding: 15px 45px;
            text-align: center;
            text-transform: uppercase;
            transition: 0.5s;
            background-size: 200% auto;
            color: white;            
            box-shadow: 0 0 20px #eee;
            border-radius: 10px;
            display: block;
          }

          .btn-grad:hover {
            background-position: right center; /* change the direction of the change here */
            color: #fff;
            text-decoration: none;
          }
         
    .btn-grad {background-image: linear-gradient(to right, #757F9A 0%, #D7DDE8  51%, #757F9A  100%)}
         .btn-grad {
            margin: 10px;
            padding: 15px 45px;
            text-align: center;
            text-transform: uppercase;
            transition: 0.5s;
            background-size: 200% auto;
            color: white;            
            box-shadow: 0 0 20px #eee;
            border-radius: 10px;
            display: block;
          }

          .btn-grad:hover {
            background-position: right center; /* change the direction of the change here */
            color: #fff;
            text-decoration: none;
          }
         
  </style>
</head>
<body>
  <div class=" container">
    <div id="movie-container"class="bg-pic  rounded shadow-lg">
      <div class="bg-pic text-center">
        <p>Loading movie details...</p>
      </div>
    </div>
  </div>

  <footer class="text-center mt-4 mb-3 text-muted">Data provided by YASH</footer>

  <script>
    const OMDB_KEY = "1f818a3f";
    const POSTS_JSON_URL = "posts.json";

    async function fetchMovieData(title) {
      try {
        const res = await fetch(`https://www.omdbapi.com/?apikey=${OMDB_KEY}&t=${encodeURIComponent(title)}&plot=full`);
        const data = await res.json();
        if (data.Response === "True") {
          return data;
        } else {
          console.log('OMDb response:', data.Error);
          return null;
        }
      } catch (err) {
        console.error('OMDb error:', err);
        return null;
      }
    }

    async function loadPosts() {
      try {
        const res = await fetch(POSTS_JSON_URL);
        const posts = await res.json();
        return posts.map(p => ({...p, id: parseInt(p.id)}));
      } catch (err) {
        console.error('Error loading posts:', err);
        return [];
      }
    }

    (async function init() {
      try {
        const posts = await loadPosts();
        const urlParams = new URLSearchParams(window.location.search);
        const id = parseInt(urlParams.get("id"));
        const post = posts.find(p => p.id === id);
        const container = document.getElementById("movie-container");

        if (!post) {
          container.innerHTML = "<p class='text-center'>Movie not found.</p>";
          return;
        }

        // Show basic info immediately with JSON poster
        container.innerHTML = `
          <h2 class="mb-3 ">${post.heading}</h2>
         
            <div class="info-section rounded">
              <img src="${post.poster}" class="poster-img mb-3 " alt="${post.heading} Poster" id="main-poster" onerror="this.style.display='none'" />
              <p><strong>Wait!! Yash entering ${post.heading} movie Data</strong></p>
            </div>
          </div>
          <div class="video-container">
              <video controls controlsList="nodownload">
                <source src="${post.videoUrl}" type="video/mp4">
                Your browser does not support the video tag.
              </video>
            </div>
          <div class="mt-3">
            <a href="${post.videoUrl}" target="_blank" class="btn-grad">Download</a>
            <a href="index.html" class="btn-grad ms-2">Back to List</a>
          </div>
        `;

        // Fetch OMDb data and update
        const omdb = await fetchMovieData(post.heading);
        
        // Use JSON poster first, OMDb poster only as fallback
        let finalPoster = post.poster;
        if (omdb && omdb.Poster && omdb.Poster !== "N/A") {
          const posterImg = document.getElementById('main-poster');
          if (posterImg && posterImg.style.display === 'none') {
            // If JSON poster failed, use OMDb poster
            finalPoster = omdb.Poster;
          }
        }
        
        if (omdb) {
          const rating = omdb.imdbRating !== "N/A" ? `‚≠ê ${omdb.imdbRating}/10 (IMDb)` : "N/A";
          const overview = omdb.Plot || "No overview available.";
          const genres = omdb.Genre || "Unknown";
          const release = omdb.Released || "N/A";
          const runtime = omdb.Runtime || "N/A";
          const cast = omdb.Actors || "N/A";
          const director = omdb.Director || "N/A";
          const year = omdb.Year || "N/A";

          // Update with full info, keeping JSON poster
          container.innerHTML = `
            <h2 class="p-2 ">${post.heading} (${year})</h2>


             <div class="info-section shadow-lg p-3">
                <img src="${finalPoster}" class="poster-img mb-3" alt="${post.heading} Poster" onerror="this.style.display='none'" />
                <div class="post-bg shadow border-left-0 mb-1 rounded p-3">
                <p><strong>Rating:</strong> ${rating}</p>
                <p><strong>Genres:</strong> ${genres}</p>
                <p><strong>Release Date:</strong> ${release}</p>
                <p><strong>Runtime:</strong> ${runtime}</p>
                <p><strong>Director:</strong> ${director}</p>
                <p><strong>Cast:</strong> ${cast}</p>
                </div>
               
                <p class="post-bg shadow-lg border border-light rounded p-3"><strong>Plot:</strong> ${overview}</p>
              </div>
            </div>

             <div class="content-flex shadow p-2">
            <div class="video-container">
              <video controls controlsList="nodownload">
                <source src="${post.videoUrl}" type="video/mp4">
                Your browser does not support the video tag.
              </video>
            </div>
             

            
            <div class="mt-3">
              <a href="${post.videoUrl}" target="_blank" class="btn-grad">Download</a>
              <a href="index.html" class="btn-grad ms-2">Back to list</a>
            </div>
          `;
        }
      } catch (err) {
        console.error('Initialization error:', err);
        document.getElementById("movie-container").innerHTML = 
          `<p class="text-center text-danger">Error loading movie details. Please try again.</p>
           <div class="text-center mt-3">
             <a href="index.html" class="btn-grad">Back to list</a>
           </div>`;
      }
    })();
  </script>
</body>
</html>
